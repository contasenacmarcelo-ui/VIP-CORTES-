<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Vip Cortes</title>
  <link rel="stylesheet" href="style2(admin).css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Big+Shoulders:opsz,wght@10..72,100..900&display=swap"
    rel="stylesheet">
</head>


<body>
  <header>
    <div class="imagem">
      <a class="logo-vipcortes" href="index.html"><img src="./assets/Vip cortes logo.png" alt=""></a>

    </div>
    <div class="nav-main">
      <nav class="margem-esquerda">
        <a class="item" href="index.html"><b>Home</b></a>
      <a class="item" href="Avaliações.html"><b>Avaliações</b></a>
      <a class="item" href="AGENDAR.html"><b>Agendar</b></a>
      <a class="item22" href="admin.html"><b>admin</b></a>
      </nav>
      <nav class="margem-direita">
      

      </nav>


    </div>
  </header>
  <main>
    <section>
      <div class="line-branca-one"></div>
      <div class="line-branca-two"></div>
      <div class="title-admin">ADMINISTRAÇÃO</div>
    </section>
    <!-- tabela -->
    <div class="tabela-container">
      <table class="agenda">
        <thead>
          <tr>
            <th>Cliente</th>
            <th>Telefone</th>
            <th>Serviço</th>
            <th>Data</th>
            <th>Horário</th>
            <th>Ação</th>
          </tr>
        </thead>
        <tbody id="agendaBody">
          <!-- linhas serão preenchidas via JS -->
        </tbody>
      </table>
    </div>


  </main>

  <script>
    
    // Preenche tabela de agendamentos via API e adiciona botões Excluir / Adicionar Pontos
    async function carregarAgendamentos() {
      try {
        const res = await fetch('/api/agendamentos');
        const j = await res.json();
        const rows = j.appointments || [];
        const tbody = document.getElementById('agendaBody');
        tbody.innerHTML = '';
        for (const a of rows) {
          const tr = document.createElement('tr');
          const clienteTd = document.createElement('td'); clienteTd.textContent = a.name || '';
          const telefoneTd = document.createElement('td'); telefoneTd.textContent = a.phone || '';
          const servTd = document.createElement('td'); servTd.textContent = a.service || '';
          const dataTd = document.createElement('td'); dataTd.textContent = a.data_agendamento || a.date || '';
          const horaTd = document.createElement('td'); horaTd.textContent = a.hora || a.time || '';
          const actionTd = document.createElement('td');

         

          const cancelarBtn = document.createElement('button'); cancelarBtn.className = 'btn-cancelar'; cancelarBtn.textContent = 'Cancelar';
          cancelarBtn.addEventListener('click', async () => {
            if (!confirm(`Cancelar agendamento de ${a.name || 'Cliente'} ?`)) return;
            const r = await fetch(`/api/agendamentos/${a.id}`, { method: 'DELETE' });
            if (r.ok) {
              alert('Agendamento cancelado com sucesso');
              carregarAgendamentos();
            } else {
              alert('Erro ao cancelar agendamento');
            }
          });

         

          actionTd.appendChild(delBtn);
          actionTd.appendChild(document.createTextNode(' '));
          actionTd.appendChild(remarcarBtn);
          actionTd.appendChild(document.createTextNode(' '));
          actionTd.appendChild(cancelarBtn);
          actionTd.appendChild(document.createTextNode(' '));
          

          tr.appendChild(clienteTd);
          tr.appendChild(telefoneTd);
          tr.appendChild(servTd);
          tr.appendChild(dataTd);
          tr.appendChild(horaTd);
          tr.appendChild(actionTd);
          tbody.appendChild(tr);
        }
      } catch (err) {
        console.error('Erro ao carregar agendamentos:', err);
      }
    }

    // Chamar a função ao carregar a página
    carregarAgendamentos();
  </script>
</body>

</html>